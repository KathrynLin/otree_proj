<!-- Calculator Data Logger - Stores localStorage via AJAX for server-side processing -->
<script>
$(document).ready(function() {
    // Send calculator data when page loads, before any form submission
    var participantCode = window.location.pathname.split('/')[2];
    var sessionCode = $('#session-code').text();
    var gameType = window.location.pathname.split('/')[3]; // Extract game type from URL
    // Convert quiz_* to public_goods_* to match the actual game type
    if (gameType && gameType.startsWith('quiz_')) {
        gameType = gameType.replace('quiz_', 'public_goods_');
    }
    var pageKey = 'calculator_logs_' + gameType + '_' + sessionCode + '_' + participantCode;

    var logs = localStorage.getItem(pageKey) || '[]';
    var count = JSON.parse(logs).length;
    console.log('[Calculator] Sending ' + count + ' submissions from key: ' + pageKey);

    // Send calculator data to server via live method immediately on page load
    liveSend({'calculator_data': logs});
});
</script>
